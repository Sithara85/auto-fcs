---
title: "plotTSNE"
author: "JL"
date: "2/15/2017"
output: html_document
---
```{r analyze, eval=TRUE}
library(cytofkit)
library(flowCore)

file = "~/temp/fcs/2016-05-20_PANEL 2_ZF_panel 2_F1632217_009.fcs"
manual = read.delim("~/temp/fcs/2016-05-20_PANEL 2_ZF_panel 2_F1632217_009_coding.xln",header = FALSE)

data_transformed <- cytof_exprsExtract(fcsFile = file, markers = NULL, 
                                       comp = FALSE,
                                       transformMethod = "autoLgcl")
# data_transformed =cbind(data_transformed, manual)

data_transformed_xk <- data_transformed[ which(manual$V1>0), ]


## run PhenoGraph
cluster_PhenoGraph <- cytof_cluster(xdata = data_transformed_xk, method = "Rphenograph")

data_transformed_xk_tsne <- cytof_dimReduction(data=data_transformed_xk, method = "tsne")

data_xk_all <- cbind(data_transformed_xk, data_transformed_xk_tsne, 
                     PhenoGraph = cluster_PhenoGraph)
data_xk_all <- as.data.frame(data_xk_all)

save(data_xk_all,file = "~/temp/fcs/testRun.rdata")

# cytof_addToFCS(data_xk_all, rawFCSdir=dir, analyzedFCSdir="analysed_FCS", 
#                transformed_cols = c("tsne_1", "tsne_2"), 
#                cluster_cols = c("PhenoGraph", "ClusterX", "FlowSOM"))
```

```{r plot}
library(ggplot2)
library(cytofkit)
library(flowCore)

load("~/temp/fcs/testRun.rdata")

ggplot(data_xk_all , aes(x = tsne_1,y=tsne_2,color=PhenoGraph)) +geom_point()

```

